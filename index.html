<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Triathlon pace guide</title>

    <!-- Bootstrap -->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/9.3.0/css/bootstrap-slider.min.css">
<style>
/* Sticky footer styles
-------------------------------------------------- */
html {
  position: relative;
  min-height: 100%;
}
body {
  /* Margin bottom by footer height */
  margin-bottom: 60px;
}
.footer {
  position: absolute;
  bottom: 0;
  width: 100%;
  /* Set the fixed height of the footer here */
  height: 60px;
  background-color: #f5f5f5;
}




/* Slider indicators as to what direction is good and not good as pace and speed are inverse of each other */

#swim-pace-slider .slider-selection, #t1-slider .slider-selection, #run-pace-slider .slider-selection, #t2-slider .slider-selection, #bike-pace-slider .slider-track-high{
	background: green;
}
#bike-pace-slider .slider-selection, #swim-pace-slider .slider-track-high, #t1-slider .slider-track-high, #t2-slider .slider-track-high, #run-pace-slider .slider-track-high{
	background: red;
}

</style>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <!-- Begin page content -->
    <div class="container">
      <div class="page-header">
        <h1>Triathlon pace guide</h1>
      </div>
      <p class="lead">Adjust your pace, see what times you could get (if you stopped play with this and did something productive!).</p>
      
      <div class="form-group">
        <label>Distance</label>
        <select class="form-control" data-bind="options: distances, optionsText: 'name', value: selectedDistances">            
        </select>
      </div>
    
    
    <form class="form-horizontal">
    <fieldset>
        <legend>Swim <small data-bind="text:swimDistanceDisplay"></small> </legend>
        <div class="form-group">
            <label for="run-pace-slider" class="col-sm-2 control-label">Pace (min/100m)</label>
            <div class="col-sm-10">
                <input id="swim-pace-slider" data-slider-id='swim-pace-slider' type="text" data-slider-min="0" data-slider-max="270" data-slider-step="1" data-bind="attr: { 'data-slider-value': swimPaceAsSeconds }" style="width:100%"/>
								<div class="col-sm-6">Pace:<span data-bind="text: swimPace"></div> 
								<div class="col-sm-6 text-right">Duration: <span data-bind="text: swimDurationDisplay"></span></div>
            </div>
        </div>       
    </fieldset>
		<fieldset>
        <legend>Transition 1</legend>
        <div class="form-group">
            <label for="run-pace-slider" class="col-sm-2 control-label">Time</label>
            <div class="col-sm-10">
                <input id="t1-slider" data-slider-id='t1-slider' type="text" data-slider-min="0" data-slider-max="600" data-slider-step="1" data-bind="attr: { 'data-slider-value': t1AsSeconds }" style="width:100%"/>
								<div class="col-sm-12 text-right">Duration: <span data-bind="text: t1DurationDisplay"></span></div>
            </div>
        </div>       
    </fieldset>
    <fieldset>
        <legend>Bike <small data-bind="text:bikeDistanceDisplay"> </small></legend>
        <div class="form-group">
            <label for="bike-pace-slider" class="col-sm-2 control-label">Speed (km/hour)</label>
            <div class="col-sm-10">
                <input id="bike-pace-slider" data-slider-id='bike-pace-slider' type="text" data-slider-min="0" data-slider-max="60" data-slider-step="0.01" data-bind="attr: { 'data-slider-value': bikeSpeedAsKmph }" style="width:100%"/>
              	<div class="col-sm-6">Speed:<span data-bind="text: bikeSpeed"></div> 
								<div class="col-sm-6 text-right">Duration: <span data-bind="text: bikeDurationDisplay"></span></div>
            </div>
        </div>       
    </fieldset>
		<fieldset>
        <legend>Transition 2</legend>
        <div class="form-group">
            <label for="run-pace-slider" class="col-sm-2 control-label">Time</label>
            <div class="col-sm-10">
                <input id="t2-slider" data-slider-id='t2-slider' type="text" data-slider-min="0" data-slider-max="600" data-slider-step="1" data-bind="attr: { 'data-slider-value': t2AsSeconds }" style="width:100%"/>
               	<div class="col-sm-12 text-right">Duration: <span data-bind="text: t2DurationDisplay"></span></div>
            </div>
        </div>       
    </fieldset>
     <fieldset>
        <legend>Run <small data-bind="text:runDistanceDisplay"> </small></legend>
        <div class="form-group">
            <label for="run-pace-slider" class="col-sm-2 control-label">Pace (min/km)</label>
            <div class="col-sm-10">
                <input id="run-pace-slider" data-slider-id='run-pace-slider' type="text" data-slider-min="0" data-slider-max="480" data-slider-step="1" data-bind="attr: { 'data-slider-value': runPaceAsSeconds }" style="width:100%"/>
								<div class="col-sm-6">Pace:<span data-bind="text: runPace"></div> 
								<div class="col-sm-6 text-right">Duration: <span data-bind="text: runDurationDisplay"></span></div>
            </div>
        </div>       
    </fieldset>
    <h3>Total duration: <span data-bind="text: totalDurationDisplay"></span></h3>
    </form>
    
    <!-- end container -->
    </div>    
    
</form>
    
    
    <footer class="footer">
      <div class="container">
        <p class="text-muted text-center">Hacked together by @RhysC.</p>
      </div>
    </footer>


    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <!-- http://knockoutjs.com/ -->
    <script src="https://ajax.aspnetcdn.com/ajax/knockout/knockout-3.3.0.js"></script>
    <!-- https://github.com/seiyria/bootstrap-slider -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/9.3.0/bootstrap-slider.min.js"></script>
    <!-- http://momentjs.com/docs/#/durations/ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.15.2/moment.min.js"></script>
    <!-- https://github.com/jsmreese/moment-duration-format --> 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment-duration-format/1.3.0/moment-duration-format.min.js"></script>
    <script>
        function TriViewModel() {
            var self = this;
            self.distances = [
                {'name': 'Sprint', 'swimDistanceAsMeters': 750, 'bikeDistanceAsMeters': 20000, 'runDistanceAsMeters':5000},
                {'name': 'Olympic', 'swimDistanceAsMeters': 1500, 'bikeDistanceAsMeters': 40000, 'runDistanceAsMeters':10000},
                {'name': 'ITU Long', 'swimDistanceAsMeters': 3000, 'bikeDistanceAsMeters': 80000, 'runDistanceAsMeters':20000},
                {'name': 'Half / 70.3', 'swimDistanceAsMeters': 1900, 'bikeDistanceAsMeters': 90000, 'runDistanceAsMeters':21090},
                {'name': 'Full/Ironman', 'swimDistanceAsMeters': 3800, 'bikeDistanceAsMeters': 180000, 'runDistanceAsMeters':42195}
            ];
            self.selectedDistances = ko.observable(self.distances[3]);
            /*self.swimDistanceAsMeters= ko.observable(1900);
            self.bikeDistanceAsMeters= ko.observable(91100);
            self.runDistanceAsMeters= ko.observable(21100);*/
            
            self.swimDistanceAsMeters = ko.computed(function() {
                return self.selectedDistances().swimDistanceAsMeters;
            });           
            self.bikeDistanceAsMeters = ko.computed(function() {
                return self.selectedDistances().bikeDistanceAsMeters;
            });           
            self.runDistanceAsMeters = ko.computed(function() {
                return self.selectedDistances().runDistanceAsMeters;
            });           
            
            self.swimPaceAsSeconds= ko.observable(90);
            self.t1AsSeconds= ko.observable(180);
            self.bikeSpeedAsKmph= ko.observable(30.00);
            self.t2AsSeconds= ko.observable(180);
            self.runPaceAsSeconds= ko.observable(360);

            self.swimPace = ko.computed(function() {
                return moment.duration(self.swimPaceAsSeconds(), 'seconds').format("mm:ss");
            });            
            self.bikeSpeed = ko.computed(function() {
                return self.bikeSpeedAsKmph();
            });
            self.runPace = ko.computed(function() {
                return moment.duration(self.runPaceAsSeconds(), 'seconds').format("mm:ss");
            });
            self.swimDuration = ko.computed(function() {
                return moment.duration(self.swimPaceAsSeconds() * self.swimDistanceAsMeters()/100, 'seconds');
            });
						self.t1Duration = ko.computed(function() {
                return moment.duration(self.t1AsSeconds(), 'seconds');
            });
            self.bikeDuration = ko.computed(function() {
                return moment.duration(self.bikeDistanceAsMeters()/1000 / self.bikeSpeedAsKmph(), 'hours');
            });
						self.t2Duration = ko.computed(function() {
                return moment.duration(self.t2AsSeconds(), 'seconds');
            });
            self.runDuration = ko.computed(function() {
                return moment.duration(self.runPaceAsSeconds() * self.runDistanceAsMeters()/1000, 'seconds');
            });
            self.swimDurationDisplay = ko.computed(function() {
                return self.swimDuration().format("hh:mm:ss");
            });
						self.t1DurationDisplay = ko.computed(function() {
                return self.t1Duration().format("hh:mm:ss");
            });
            self.bikeDurationDisplay = ko.computed(function() {
                return self.bikeDuration().format("hh:mm:ss");
            });
            self.t2DurationDisplay = ko.computed(function() {
                return self.t2Duration().format("hh:mm:ss");
            });
            self.runDurationDisplay = ko.computed(function() {
                return self.runDuration().format("hh:mm:ss");
            });
						function distanceDisplay(distanceInMeters){
							if(distanceInMeters < 1000){
								return distanceInMeters + "m"
							}
							else{
								return distanceInMeters/1000 + "km"
							}
						}
						self.swimDistanceDisplay = ko.computed(function() {								
                return distanceDisplay(self.swimDistanceAsMeters());
            });
						self.bikeDistanceDisplay = ko.computed(function() {
                return distanceDisplay(self.bikeDistanceAsMeters());
            });
						self.runDistanceDisplay = ko.computed(function() {
                return distanceDisplay(self.runDistanceAsMeters());
            });
            
            self.totalDuration = ko.computed(function() {
                return moment.duration().add(self.swimDuration()).add(self.t1Duration()).add(self.runDuration()).add(self.t2Duration()).add(self.bikeDuration());
            });
            self.totalDurationDisplay = ko.computed(function() {
                return self.totalDuration().format("hh:mm:ss");
            });
        };
        $(document).ready(function () {            
            var viewModel = new TriViewModel();
            ko.applyBindings(viewModel);
           
            $('#swim-pace-slider').slider({
                formatter: function(value) {                    
                    return 'Pace: ' + viewModel.swimPace();
                }
            }).on('change', function(ev){
                viewModel.swimPaceAsSeconds(ev.value.newValue);                
            });
						$('#t1-slider').slider({
                formatter: function(value) {                    
                    return 'Duration: ' + viewModel.t1DurationDisplay();
                }
            }).on('change', function(ev){
                viewModel.t1AsSeconds(ev.value.newValue);                
            });
            $('#bike-pace-slider').slider({
                formatter: function(value) {                    
                    return 'Speed: ' + viewModel.bikeSpeed();
                }
            }).on('change', function(ev){
                viewModel.bikeSpeedAsKmph(ev.value.newValue);                
            });
						$('#t2-slider').slider({
                formatter: function(value) {                    
                    return 'Duration: ' + viewModel.t2DurationDisplay();
                }
            }).on('change', function(ev){
                viewModel.t2AsSeconds(ev.value.newValue);                
            });
            $('#run-pace-slider').slider({
                formatter: function(value) {                    
                    return 'Pace: ' + viewModel.runPace();
                }
            }).on('change', function(ev){
                viewModel.runPaceAsSeconds(ev.value.newValue);                
            });
            

        });         
    </script>
  </body>
</html>
